(function(modules){function webpackJsonpCallback(data){var chunkIds=data[0];var moreModules=data[1];var executeModules=data[2];var moduleId,chunkId,i=0,resolves=[];for(;i<chunkIds.length;i++){chunkId=chunkIds[i];if(Object.prototype.hasOwnProperty.call(installedChunks,chunkId)&&installedChunks[chunkId]){resolves.push(installedChunks[chunkId][0])}installedChunks[chunkId]=0}for(moduleId in moreModules){if(Object.prototype.hasOwnProperty.call(moreModules,moduleId)){modules[moduleId]=moreModules[moduleId]}}if(parentJsonpFunction)parentJsonpFunction(data);while(resolves.length){resolves.shift()()}deferredModules.push.apply(deferredModules,executeModules||[]);return checkDeferredModules()};function checkDeferredModules(){var result;for(var i=0;i<deferredModules.length;i++){var deferredModule=deferredModules[i];var fulfilled=!0;for(var j=1;j<deferredModule.length;j++){var depId=deferredModule[j];if(installedChunks[depId]!==0)fulfilled=!1}if(fulfilled){deferredModules.splice(i--,1);result=__webpack_require__(__webpack_require__.s=deferredModule[0])}}return result}var installedModules={};var installedChunks={8:0};var deferredModules=[];function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=!0;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:!0,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=='undefined'&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:'Module'})}Object.defineProperty(exports,'__esModule',{value:!0})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if((mode&4)&&typeof value==='object'&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,'default',{enumerable:!0,value:value});if(mode&2&&typeof value!='string')for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module['default']}:function getModuleExports(){return module};__webpack_require__.d(getter,'a',getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";var jsonpArray=window.webpackJsonp=window.webpackJsonp||[];var oldJsonpFunction=jsonpArray.push.bind(jsonpArray);jsonpArray.push=webpackJsonpCallback;jsonpArray=jsonpArray.slice();for(var i=0;i<jsonpArray.length;i++)webpackJsonpCallback(jsonpArray[i]);var parentJsonpFunction=oldJsonpFunction;deferredModules.push(["A9IG",0]);return checkDeferredModules()})({"A9IG":(function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"checkoutControlsSelectors",function(){return checkoutControlsSelectors});__webpack_require__.d(__webpack_exports__,"setIsInterruptable",function(){return setIsInterruptable});__webpack_require__.d(__webpack_exports__,"isInterruptable",function(){return isInterruptable});__webpack_require__.d(__webpack_exports__,"isExpired",function(){return isExpired});__webpack_require__.d(__webpack_exports__,"isStarted",function(){return isStarted});__webpack_require__.d(__webpack_exports__,"findTimerData",function(){return findTimerData});__webpack_require__.d(__webpack_exports__,"beaconInterrupt",function(){return beaconInterrupt});__webpack_require__.d(__webpack_exports__,"syncWithBackend",function(){return syncWithBackend});__webpack_require__.d(__webpack_exports__,"start",function(){return start});__webpack_require__.d(__webpack_exports__,"reset",function(){return session_reset});__webpack_require__.d(__webpack_exports__,"pause",function(){return pause});__webpack_require__.d(__webpack_exports__,"resume",function(){return resume});__webpack_require__.d(__webpack_exports__,"setTargetDom",function(){return setTargetDom});__webpack_require__.d(__webpack_exports__,"syncOnLoad",function(){return syncOnLoad});__webpack_require__.d(__webpack_exports__,"watchCheckoutControls",function(){return watchCheckoutControls});__webpack_require__.d(__webpack_exports__,"getWatchedCheckoutControls",function(){return getWatchedCheckoutControls});__webpack_require__.d(__webpack_exports__,"setHealthcheckLoopId",function(){return setHealthcheckLoopId});__webpack_require__.d(__webpack_exports__,"getHealthcheckTimeoutId",function(){return getHealthcheckTimeoutId});__webpack_require__.d(__webpack_exports__,"getCountdownTimeoutId",function(){return getCountdownTimeoutId});__webpack_require__.d(__webpack_exports__,"getResumeTimeoutId",function(){return getResumeTimeoutId});var defineProperty=__webpack_require__("lSNA");var defineProperty_default=__webpack_require__.n(defineProperty);var asyncToGenerator=__webpack_require__("yXPU");var asyncToGenerator_default=__webpack_require__.n(asyncToGenerator);const localizedData=tec.tickets.seating.frontend.session;var style=__webpack_require__("lo4d");var external_wp_hooks_=__webpack_require__("g56x");var external_tec_tickets_seating_utils_=__webpack_require__("MsaN");function InterruptDialogComponent(props){return Object(external_tec_tickets_seating_utils_.createHtmlComponentFromTemplateString)(`<script
		id="tec-tickets-seating-interrupt-dialog-template"
		type="text/template"
		data-js="{dataJs}"
	>
		<div class="tribe-tickets-seating__interrupt-dialog" role="dialog">
			<div class="tribe-tickets-seating__interrupt-header">
				<div class="dashicons dashicons-clock"></div>
				<p class="tribe-tickets-seating__interrupt-title">{title}</p>
			</div>
			<div class="tribe-dialog__content tribe-modal__content tribe-tickets-seating__interrupt-content">{content}</div>
			<div class="tribe-tickets-seating__interrupt-footer">
				<button
					type="button"
					onclick="window.location.href='{redirectUrl}'"
					class="tribe-common-c-btn tribe-common-c-btn--small"
				>
					{buttonLabel}
				</button>
		</div>
	</script>`,props)}
var external_wp_i18n_=__webpack_require__("l3Sj");function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}
function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){defineProperty_default()(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}
const{ajaxUrl,ajaxNonce,ACTION_START,ACTION_SYNC,ACTION_INTERRUPT_GET_DATA}=localizedData;const selector='.tec-tickets-seating__timer';const hiddenClassName='tec-tickets-seating__timer--hidden';let countdownTimeoutId=null;let healthCheckTimeoutId=null;let resumeTimeoutId=null;let started=!1;let interruptable=!0;let expired=!1;let interruptDialogElement=null;let targetDom=document;let watchedCheckoutControls=[];const checkoutControlsSelectors='.tribe-tickets__commerce-checkout-form-submit-button, .tribe-tickets__commerce-checkout-paypal-buttons button';function setIsInterruptable(interruptableFlag){interruptable=interruptableFlag}
function isInterruptable(){return interruptable}
function setIsExpired(expiredFlag){expired=expiredFlag}
function isExpired(){return expired}
function setIsStarted(startedFlag){started=startedFlag}
function isStarted(){return started}
function getTimerElements(){return targetDom.querySelectorAll(selector)}
function findTimerData(){const sourceTimerElements=getTimerElements();if(sourceTimerElements.length===0){return null}
let token=null;let postId=null;let redirectUrl=null;Array.from(sourceTimerElements).find(timerElement=>{if(timerElement.dataset.token&&timerElement.dataset.postId&&timerElement.dataset.redirectUrl){token=timerElement.dataset.token;postId=timerElement.dataset.postId;redirectUrl=timerElement.dataset.redirectUrl;return!0}
return!1});if(!(token&&postId&&redirectUrl)){return null}
return{token,postId,redirectUrl}}
function setTimerTimeLeft(timerElement,minutes,seconds){timerElement.classList.remove(hiddenClassName);const minutesElement=timerElement.querySelector('.tec-tickets-seating__time-minutes');const secondsElement=timerElement.querySelector('.tec-tickets-seating__time-seconds');if(!minutesElement||!secondsElement){return}
minutesElement.innerText=minutes;secondsElement.innerText=String(seconds).padStart(2,'0')}
function fetchInterruptModalData(){return _fetchInterruptModalData.apply(this,arguments)}function _fetchInterruptModalData(){_fetchInterruptModalData=asyncToGenerator_default()(function*(){const{postId,token}=findTimerData();const requestUrl=new URL(ajaxUrl);requestUrl.searchParams.set('_ajaxNonce',ajaxNonce);requestUrl.searchParams.set('action',ACTION_INTERRUPT_GET_DATA);requestUrl.searchParams.set('postId',postId);requestUrl.searchParams.set('token',token);const response=yield fetch(requestUrl.toString(),{method:'GET'});const defaultData={title:Object(external_wp_i18n_._x)('Time limit expired','Seat selection expired timer title','event-tickets'),content:Object(external_wp_i18n_._x)('Your seat selections are no longer reserved, but tickets are still available.','Seat selection expired timer content','event-tickets'),buttonLabel:Object(external_wp_i18n_._x)('Find Seats','Seat selection expired timer button label','event-tickets'),redirectUrl:window.location.href};if(!response.ok){console.error('Failed to fetch interrupt modal data');return defaultData}
const responseJson=yield response.json();if(!(responseJson.success&&responseJson.data)){console.error('Failed to fetch interrupt modal data');return defaultData}
return{title:responseJson.data.title||defaultData.title,content:responseJson.data.content||defaultData.content,buttonLabel:responseJson.data.buttonLabel||defaultData.buttonLabel,redirectUrl:responseJson.data.redirectUrl||defaultData.redirectUrl}});return _fetchInterruptModalData.apply(this,arguments)}
function getInterruptDialogElement(){return _getInterruptDialogElement.apply(this,arguments)}function _getInterruptDialogElement(){_getInterruptDialogElement=asyncToGenerator_default()(function*(){var _getTimerElements;const firstTimerElement=(_getTimerElements=getTimerElements())===null||_getTimerElements===void 0?void 0:_getTimerElements[0];if(!firstTimerElement){console.warn('No timer element found');return null}
const dialogDataJSAttribute='dialog-content-tec-tickets-seating-timer-interrupt';const{title,content,buttonLabel,redirectUrl}=yield fetchInterruptModalData();firstTimerElement.dataset.content=dialogDataJSAttribute;let appendTarget='.tec-tickets-seating__timer';const dialogParent=firstTimerElement.closest('.tribe-dialog');if(dialogParent){appendTarget='.tribe-tickets__tickets-form, .tec-tickets-seating__tickets-block'}
if(!interruptDialogElement){var _targetDom$querySelec;interruptDialogElement=InterruptDialogComponent({dataJs:dialogDataJSAttribute,title,content,buttonLabel,redirectUrl});(_targetDom$querySelec=targetDom.querySelector(appendTarget))===null||_targetDom$querySelec===void 0?void 0:_targetDom$querySelec.appendChild(interruptDialogElement)}
return new A11yDialog({trigger:'.tec-tickets-seating__timer',appendTarget,wrapperClasses:'tribe-dialog',overlayClasses:'tribe-dialog__overlay tribe-modal__overlay',contentClasses:'tribe-dialog__wrapper tribe-tickets-seating__interrupt-wrapper',overlayClickCloses:!1})});return _getInterruptDialogElement.apply(this,arguments)}
function interrupt(){return _interrupt.apply(this,arguments)}function _interrupt(){_interrupt=asyncToGenerator_default()(function*(){if(!isInterruptable()){return}
setIsInterruptable(!0);getTimerElements().forEach(timerElement=>{setTimerTimeLeft(timerElement,0,0)});setIsExpired(!0);clearTimeout(countdownTimeoutId);countdownTimeoutId=null;clearTimeout(healthCheckTimeoutId);healthCheckTimeoutId=null;const interruptDialog=yield getInterruptDialogElement();Object(external_wp_hooks_.doAction)('tec.tickets.seating.timer_interrupt');if(interruptDialog){interruptDialog.show();interruptDialog.shown=!1}
setIsInterruptable(!1)});return _interrupt.apply(this,arguments)}
function beaconInterrupt(){if(!isInterruptable()){return}
const{postId,token}=findTimerData();const requestUrl=new URL(ajaxUrl);requestUrl.searchParams.set('_ajaxNonce',ajaxNonce);requestUrl.searchParams.set('action',ACTION_INTERRUPT_GET_DATA);requestUrl.searchParams.set('postId',postId);requestUrl.searchParams.set('token',token);window.navigator.sendBeacon(requestUrl.toString())}
function startCountdownLoop(secondsLeft){if(!isInterruptable()){return}
if(secondsLeft<=0){interrupt();return}
setIsStarted(!0);countdownTimeoutId=setTimeout(()=>{secondsLeft-=1;getTimerElements().forEach(timerElement=>{setTimerTimeLeft(timerElement,Math.floor(secondsLeft/60),secondsLeft%60)});if(!isExpired()){startCountdownLoop(secondsLeft)}},1000)}
function startHealthCheckLoop(){if(isExpired()||!isInterruptable()){return}
healthCheckTimeoutId=setTimeout(asyncToGenerator_default()(function*(){yield syncWithBackend();startHealthCheckLoop()}),3*1000)}
function syncWithBackend(){return _syncWithBackend.apply(this,arguments)}
function _syncWithBackend(){_syncWithBackend=asyncToGenerator_default()(function*(){if(isExpired()||getTimerElements().length===0||!isInterruptable()){return}
const secondsLeft=yield requestToBackend(ACTION_SYNC);if(secondsLeft<=0){interrupt();return}
if(countdownTimeoutId){clearTimeout(countdownTimeoutId);countdownTimeoutId=null}
startCountdownLoop(secondsLeft);if(!healthCheckTimeoutId){startHealthCheckLoop()}});return _syncWithBackend.apply(this,arguments)}
function requestToBackend(_x2){return _requestToBackend.apply(this,arguments)}function _requestToBackend(){_requestToBackend=asyncToGenerator_default()(function*(action){const timerData=findTimerData();if(timerData===null){return!1}
if([ACTION_START,ACTION_SYNC].indexOf(action)===-1){return!1}
const requestUrl=new URL(ajaxUrl);requestUrl.searchParams.set('_ajaxNonce',ajaxNonce);requestUrl.searchParams.set('action',action);requestUrl.searchParams.set('token',timerData.token);requestUrl.searchParams.set('postId',timerData.postId);const response=yield fetch(requestUrl.toString(),{method:'POST'});if(!response.ok){return!1}
const responseJson=yield response.json();if(!(responseJson.success&&responseJson.data.secondsLeft&&responseJson.data.timestamp)){console.error('Failed to communicate with the backend');return!1}
const startTimerResponse=responseJson.data;return startTimerResponse.secondsLeft-Math.max(0,Math.floor(startTimerResponse.timestamp-Date.now()/1000))});return _requestToBackend.apply(this,arguments)}
function start(){return _start.apply(this,arguments)}
function _start(){_start=asyncToGenerator_default()(function*(){if(setIsStarted()||getTimerElements().length===0){return}
const secondsLeft=yield requestToBackend(ACTION_START);const{postId,token}=findTimerData();if(!(secondsLeft&&postId&&token)){interrupt();return}
const minutes=Math.floor(secondsLeft/60);const seconds=secondsLeft%60;getTimerElements().forEach(timerElement=>{setTimerTimeLeft(timerElement,minutes,seconds)});setIsStarted(!0);startCountdownLoop(secondsLeft);startHealthCheckLoop()});return _start.apply(this,arguments)}
function session_reset(){if(countdownTimeoutId){clearTimeout(countdownTimeoutId)}
if(healthCheckTimeoutId){clearTimeout(healthCheckTimeoutId)}
if(resumeTimeoutId){clearTimeout(resumeTimeoutId)}
started=!1;expired=!1;healthCheckTimeoutId=null;countdownTimeoutId=null;resumeTimeoutId=null;interruptable=!0;stopWatchingCheckoutControls()}
function pause(){setIsInterruptable(!1);if(healthCheckTimeoutId){clearTimeout(healthCheckTimeoutId);healthCheckTimeoutId=null}
if(countdownTimeoutId){clearTimeout(countdownTimeoutId);countdownTimeoutId=null}
resumeTimeoutId=setTimeout(resume,30000)}
function resume(){return _resume.apply(this,arguments)}
function _resume(){_resume=asyncToGenerator_default()(function*(){if(resumeTimeoutId){clearTimeout(resumeTimeoutId);resumeTimeoutId=null}
setIsInterruptable(!0);yield syncWithBackend()});return _resume.apply(this,arguments)}
function setTargetDom(targetDocument){targetDom=targetDocument||document}
function syncOnLoad(){return _syncOnLoad.apply(this,arguments)}
function _syncOnLoad(){_syncOnLoad=asyncToGenerator_default()(function*(){const syncTimerElements=Array.from(getTimerElements()).filter(syncTimerElement=>{return'syncOnLoad' in syncTimerElement.dataset});if(syncTimerElements.length===0){return}
setIsInterruptable(!0);window.addEventListener('beforeunload',beaconInterrupt);yield syncWithBackend()});return _syncOnLoad.apply(this,arguments)}
function watchCheckoutControls(){const filteredCheckoutControls=Object(external_wp_hooks_.applyFilters)('tec.tickets.seating.frontend.session.checkoutControls',checkoutControlsSelectors);const checkoutControlElements=targetDom.querySelectorAll(filteredCheckoutControls);checkoutControlElements.forEach(checkoutControlElement=>{watchedCheckoutControls.push(checkoutControlElement);checkoutControlElement.addEventListener('click',pause);checkoutControlElement.addEventListener('submit',pause)})}
function stopWatchingCheckoutControls(){watchedCheckoutControls.forEach(checkoutControlElement=>{checkoutControlElement.removeEventListener('click',pause);checkoutControlElement.removeEventListener('submit',pause)});watchedCheckoutControls=[]}
function getWatchedCheckoutControls(){return watchedCheckoutControls}
function setHealthcheckLoopId(id){healthCheckTimeoutId=id;return healthCheckTimeoutId}
function getHealthcheckTimeoutId(){return healthCheckTimeoutId}
function getCountdownTimeoutId(){return countdownTimeoutId}
function getResumeTimeoutId(){return resumeTimeoutId}
Object(external_tec_tickets_seating_utils_.onReady)(()=>syncOnLoad());Object(external_tec_tickets_seating_utils_.onReady)(()=>watchCheckoutControls());window.tec=window.tec||{};window.tec.tickets=window.tec.tickets||{};window.tec.tickets.seating=window.tec.tickets.seating||{};window.tec.tickets.seating.frontend=window.tec.tickets.seating.frontend||{};window.tec.tickets.seating.frontend.session=_objectSpread(_objectSpread({},window.tec.tickets.seating.frontend.session||{}),{},{start,reset:session_reset,syncOnLoad,interrupt,setIsInterruptable})}),"MsaN":(function(module,exports){module.exports=tec.tickets.seating.utils}),"g56x":(function(module,exports){module.exports=wp.hooks}),"l3Sj":(function(module,exports){module.exports=wp.i18n}),"lo4d":(function(module,exports,__webpack_require__){})})