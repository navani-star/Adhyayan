(function(modules){function webpackJsonpCallback(data){var chunkIds=data[0];var moreModules=data[1];var executeModules=data[2];var moduleId,chunkId,i=0,resolves=[];for(;i<chunkIds.length;i++){chunkId=chunkIds[i];if(Object.prototype.hasOwnProperty.call(installedChunks,chunkId)&&installedChunks[chunkId]){resolves.push(installedChunks[chunkId][0])}installedChunks[chunkId]=0}for(moduleId in moreModules){if(Object.prototype.hasOwnProperty.call(moreModules,moduleId)){modules[moduleId]=moreModules[moduleId]}}if(parentJsonpFunction)parentJsonpFunction(data);while(resolves.length){resolves.shift()()}deferredModules.push.apply(deferredModules,executeModules||[]);return checkDeferredModules()};function checkDeferredModules(){var result;for(var i=0;i<deferredModules.length;i++){var deferredModule=deferredModules[i];var fulfilled=!0;for(var j=1;j<deferredModule.length;j++){var depId=deferredModule[j];if(installedChunks[depId]!==0)fulfilled=!1}if(fulfilled){deferredModules.splice(i--,1);result=__webpack_require__(__webpack_require__.s=deferredModule[0])}}return result}var installedModules={};var installedChunks={15:0};var deferredModules=[];function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=!0;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:!0,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=='undefined'&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:'Module'})}Object.defineProperty(exports,'__esModule',{value:!0})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if((mode&4)&&typeof value==='object'&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,'default',{enumerable:!0,value:value});if(mode&2&&typeof value!='string')for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module['default']}:function getModuleExports(){return module};__webpack_require__.d(getter,'a',getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";var jsonpArray=window.webpackJsonp=window.webpackJsonp||[];var oldJsonpFunction=jsonpArray.push.bind(jsonpArray);jsonpArray.push=webpackJsonpCallback;jsonpArray=jsonpArray.slice();for(var i=0;i<jsonpArray.length;i++)webpackJsonpCallback(jsonpArray[i]);var parentJsonpFunction=oldJsonpFunction;deferredModules.push(["4dmZ",0]);return checkDeferredModules()})({"4dmZ":(function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var defineProperty=__webpack_require__("lSNA");var defineProperty_default=__webpack_require__.n(defineProperty);var external_tec_tickets_seating_utils_=__webpack_require__("MsaN");function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}
function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){defineProperty_default()(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}
const{_x}=wp.i18n;const BAD_SERVICE_RESPONSE='BAD_SERVICE_RESPONSE';const MISSING_REQUEST_PARAMETERS='MISSING_REQUEST_PARAMETERS';const MISSING_EPHEMERAL_TOKEN='MISSING_EPHEMERAL_TOKEN';const INVALID_SITE_PARAMETER='INVALID_SITE_PARAMETER';const INVALID_EXPIRE_TIME_PARAMETER='INVALID_EXPIRE_TIME_PARAMETER';const SITE_NOT_FOUND='SITE_NOT_FOUND';const EPHEMERAL_TOKEN_STORE_ERROR='EPHEMERAL_TOKEN_STORE_ERROR';const SITE_NOT_AUTHORIZED='SITE_NOT_AUTHORIZED';const unknownError=_x('Unknown error','Error message','event-tickets');const errorCodeToMessageMap={BAD_SERVICE_RESPONSE:Object(external_tec_tickets_seating_utils_.getLocalizedString)('bad-service-response','service-errors'),MISSING_REQUEST_PARAMETERS:Object(external_tec_tickets_seating_utils_.getLocalizedString)('missing-request-parameters','service-errors'),INVALID_SITE_PARAMETER:Object(external_tec_tickets_seating_utils_.getLocalizedString)('invalid-site-parameter','service-errors'),INVALID_EXPIRE_TIME_PARAMETER:Object(external_tec_tickets_seating_utils_.getLocalizedString)('invalid-expire-time-parameter','service-errors'),MISSING_EPHEMERAL_TOKEN:Object(external_tec_tickets_seating_utils_.getLocalizedString)('missing-ephemeral-token','service-errors'),SITE_NOT_FOUND:Object(external_tec_tickets_seating_utils_.getLocalizedString)('site-not-found','service-errors'),EPHEMERAL_TOKEN_STORE_ERROR:Object(external_tec_tickets_seating_utils_.getLocalizedString)('ephemeral-token-store-error','service-errors'),SITE_NOT_AUTHORIZED:Object(external_tec_tickets_seating_utils_.getLocalizedString)('site-not-authorized','service-errors')};function getErrorMessage(errorCode){return errorCodeToMessageMap[errorCode]||unknownError}
window.tec=window.tec||{};window.tec.tickets.seating=window.tec.tickets.seating||{};window.tec.tickets.seating.service=window.tec.tickets.seating.service||{};window.tec.tickets.seating.service.errors=_objectSpread(_objectSpread({},window.tec.tickets.seating.service.errors||{}),{},{BAD_SERVICE_RESPONSE,MISSING_REQUEST_PARAMETERS,MISSING_EPHEMERAL_TOKEN,INVALID_SITE_PARAMETER,INVALID_EXPIRE_TIME_PARAMETER,SITE_NOT_FOUND,EPHEMERAL_TOKEN_STORE_ERROR,SITE_NOT_AUTHORIZED,getErrorMessage});function notices_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}
function notices_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?notices_ownKeys(Object(source),!0).forEach(function(key){defineProperty_default()(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):notices_ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function getNoticeElement(){return document.getElementById('tec-tickets-seating-notice')}
function hideNotice(notice){if(!notice){return}
notice.style.display='none';notice.style.visibility='hidden'}
function showNotice(notice){if(!notice){return}
notice.style.display='block';notice.style.visibility='visible'}
function setNoticeClass(notice,className){if(!notice){return}
const classes=notice.classList;classes.remove('notice-success');classes.remove('notice-warning');classes.remove('notice-error');classes.add(className)}
function setNoticeMessage(notice,message){if(!notice){return}
notice.innerHTML='<p>'+message+'</p>'}
function notifyUserOfError(message){const notice=getNoticeElement();hideNotice(notice);setNoticeClass(notice,'notice-error');setNoticeMessage(notice,message);showNotice(notice)}
function notifyUserOfWarning(message){const notice=getNoticeElement();hideNotice(notice);setNoticeClass(notice,'notice-warning');setNoticeMessage(notice,message);showNotice(notice)}
window.tec=window.tec||{};window.tec.tickets.seating=window.tec.tickets.seating||{};window.tec.tickets.seating.service=window.tec.tickets.seating.service||{};window.tec.tickets.seating.service.notices=notices_objectSpread(notices_objectSpread({},window.tec.tickets.seating.service.notices||{}),{},{notifyUserOfWarning,notifyUserOfError});var asyncToGenerator=__webpack_require__("yXPU");var asyncToGenerator_default=__webpack_require__.n(asyncToGenerator);const localizedData=window.tec.tickets.seating.service;const baseUrl=localizedData.baseUrl.replace(/\/$/,'');const mapsHomeUrl=localizedData.mapsHomeUrl.replace(/\/$/,'');const layoutsHomeUrl=localizedData.layoutsHomeUrl.replace(/\/$/,'');const associatedEventsUrl=localizedData.associatedEventsUrl.replace(/\/$/,'');function getBaseUrl(){return baseUrl.split('?')[0]}
const INBOUND_APP_READY='app_postmessage_ready';const INBOUND_APP_READY_FOR_DATA='app_postmessage_ready_for_data';const OUTBOUND_HOST_READY='host_postmessage_ready';const OUTBOUND_SEAT_TYPE_TICKETS='host_postmessage_seat_type_tickets';const INBOUND_SEATS_SELECTED='app_postmessage_seats_selected';const INBOUND_SET_ELEMENT_HEIGHT='app_postmessage_set_element_height';const MAP_CREATED_UPDATED='app_postmessage_map_created_updated';const LAYOUT_CREATED_UPDATED='app_postmessage_layout_created_updated';const SEAT_TYPE_CREATED_UPDATED='app_postmessage_seat_type_created_updated';const SEAT_TYPES_UPDATED='app_postmessage_seat_types_updated';const SEAT_TYPE_DELETED="app_postmessage_seat_type_deleted";const RESERVATIONS_DELETED='app_postmessage_reservations_deleted';const RESERVATIONS_UPDATED='app_postmessage_reservations_updated';const RESERVATIONS_UPDATED_FOLLOWING_SEAT_TYPES='app_postmessage_reservations_updated_following_seat_types';const GO_TO_ASSOCIATED_EVENTS='app_postmessage_goto_associated_events';const RESERVATION_UPDATED='app_postmessage_reservation_updated';const RESERVATION_CREATED='app_postmessage_reservation_created';const GO_TO_MAPS_HOME='app_postmessage_goto_maps_home';const GO_TO_LAYOUTS_HOME='app_postmessage_goto_layouts_home';const OUTBOUND_REMOVE_RESERVATIONS='host_postmessage_remove_reservations';const OUTBOUND_EVENT_ATTENDEES='host_postmessage_event_attendees';const OUTBOUND_ATTENDEE_UPDATE='host_postmessage_attendee_update';var external_tec_tickets_seating_ajax_=__webpack_require__("lL5a");function defaultMessageHandler(event){console.debug('Message received from service',event)}
function invalidateMapsLayoutsCache(){return _invalidateMapsLayoutsCache.apply(this,arguments)}
function _invalidateMapsLayoutsCache(){_invalidateMapsLayoutsCache=asyncToGenerator_default()(function*(){const url=new URL(external_tec_tickets_seating_ajax_.ajaxUrl);url.searchParams.set('_ajax_nonce',external_tec_tickets_seating_ajax_.ajaxNonce);url.searchParams.set('action','tec_tickets_seating_service_invalidate_maps_layouts_cache');const response=yield fetch(url.toString(),{method:'POST'});if(response.status!==200){console.error('Invalidation of maps and layouts cache failed, clean the transients manually to fetch up-to-date maps and layouts from the service.');return!1}
return!0});return _invalidateMapsLayoutsCache.apply(this,arguments)}
function invalidateLayoutsCache(){return _invalidateLayoutsCache.apply(this,arguments)}
function _invalidateLayoutsCache(){_invalidateLayoutsCache=asyncToGenerator_default()(function*(){const url=new URL(external_tec_tickets_seating_ajax_.ajaxUrl);url.searchParams.set('_ajax_nonce',external_tec_tickets_seating_ajax_.ajaxNonce);url.searchParams.set('action','tec_tickets_seating_service_invalidate_layouts_cache');const response=yield fetch(url.toString(),{method:'POST'});if(response.status!==200){console.error('Invalidation of layouts cache failed, clean the transients manually to fetch up-to-date layouts from the service.');return!1}
return!0});return _invalidateLayoutsCache.apply(this,arguments)}
function onMapCreatedUpdated(){invalidateMapsLayoutsCache()}
function onLayoutCreatedUpdated(){invalidateLayoutsCache()}
function onSeatTypeCreatedUpdated(){invalidateLayoutsCache()}
function onGoToMapsHome(){if(!mapsHomeUrl){console.error('Maps home url not found');return}
window.location.href=mapsHomeUrl}
function onGoToLayoutsHome(){if(!layoutsHomeUrl){console.error('Layouts home url not found');return}
window.location.href=layoutsHomeUrl}
const defaultActionsMap={default:defaultMessageHandler,[MAP_CREATED_UPDATED]:onMapCreatedUpdated,[LAYOUT_CREATED_UPDATED]:onLayoutCreatedUpdated,[SEAT_TYPE_CREATED_UPDATED]:onSeatTypeCreatedUpdated,[GO_TO_MAPS_HOME]:onGoToMapsHome,[GO_TO_LAYOUTS_HOME]:onGoToLayoutsHome};const state={ready:!1,establishingReadiness:!1,actionsMap:defaultActionsMap,token:null};function getHandlerForAction(action){return state.actionsMap[action]||state.actionsMap.default||defaultMessageHandler}
function registerAction(action,callback){state.actionsMap[action]=callback}
function removeAction(action){delete state.actionsMap[action]}
function getRegisteredActions(){return state.actionsMap}
function setIsReady(isReady){state.ready=isReady}
function getIsReady(){return state.ready}
function setEstablishingReadiness(establishingReadiness){state.establishingReadiness=establishingReadiness}
function getEstablishingReadiness(){return state.establishingReadiness}
function setToken(token){state.token=token}
function getToken(){return state.token}
function state_reset(){state.ready=!1;state.establishingReadiness=!1;state.actionsMap=defaultActionsMap;state.token=null}
function api_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}
function api_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?api_ownKeys(Object(source),!0).forEach(function(key){defineProperty_default()(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):api_ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}
let handlerQueue=[];function sendPostMessage(iframe,action,data){const token=iframe.closest('[data-token]').dataset.token;if(!token){console.error('No token found in iframe element');return}
iframe.contentWindow.postMessage({action,token,data:data||null},getBaseUrl())}
function callNextHandler(){if(handlerQueue.length===0){return}
const[action,handler,event]=handlerQueue[0];const wrappedHandler=wrapHandlerForQueue(handler);wrappedHandler(event.data.data)}
function wrapHandlerForQueue(handler){return function(){var _ref=asyncToGenerator_default()(function*(data){yield handler(data);handlerQueue.shift();callNextHandler()});return function(_x){return _ref.apply(this,arguments)}}()}
function catchMessage(event){if(!(event.origin===getBaseUrl()&&event.data.token&&event.data.token===getToken())){return}
const action=event.data.action;if(!action){console.error('No action found in message');return}
const handler=getHandlerForAction(action);handlerQueue.push([action,handler,event]);if(handlerQueue.length>1){return}
callNextHandler()}
function startListeningForServiceMessages(iframe){const tokenProvider=iframe.closest('[data-token]');if(!tokenProvider){console.error('No token provider found in iframe element');return}
const token=tokenProvider.dataset.token;if(!token){console.error('No token found in token provider element');return}
setToken(token);window.addEventListener('message',catchMessage)}
function establishReadiness(_x2){return _establishReadiness.apply(this,arguments)}
function _establishReadiness(){_establishReadiness=asyncToGenerator_default()(function*(iframe){startListeningForServiceMessages(iframe);let promiseReject;const promise=new Promise((resolve,reject)=>{promiseReject=reject;const acknowledge=()=>{removeAction(INBOUND_APP_READY);setIsReady(!0);setEstablishingReadiness(!1);sendPostMessage(iframe,OUTBOUND_HOST_READY);clearTimeout(timeoutId);console.debug('Readiness established.');resolve()};registerAction(INBOUND_APP_READY,acknowledge)});const timeoutId=setTimeout(()=>{promiseReject(new Error('Connection to service timed out'))},10000);iframe.src=iframe.dataset.src;return promise});return _establishReadiness.apply(this,arguments)}
function getHandlerQueue(){return handlerQueue}
function emptyHandlerQueue(){handlerQueue=[]}
function getAssociatedEventsUrl(layoutId){return layoutId?`${associatedEventsUrl}&layout=${layoutId}`:associatedEventsUrl}
window.tec=window.tec||{};window.tec.tickets.seating=window.tec.tickets.seating||{};window.tec.tickets.seating.service=window.tec.tickets.seating.service||{};window.tec.tickets.seating.service.api=api_objectSpread(api_objectSpread({},window.tec.tickets.seating.service.api||{}),{},{INBOUND_APP_READY:INBOUND_APP_READY,INBOUND_APP_READY_FOR_DATA:INBOUND_APP_READY_FOR_DATA,INBOUND_SEATS_SELECTED:INBOUND_SEATS_SELECTED,INBOUND_SET_ELEMENT_HEIGHT:INBOUND_SET_ELEMENT_HEIGHT,OUTBOUND_EVENT_ATTENDEES:OUTBOUND_EVENT_ATTENDEES,OUTBOUND_HOST_READY:OUTBOUND_HOST_READY,OUTBOUND_REMOVE_RESERVATIONS:OUTBOUND_REMOVE_RESERVATIONS,OUTBOUND_SEAT_TYPE_TICKETS:OUTBOUND_SEAT_TYPE_TICKETS,OUTBOUND_ATTENDEE_UPDATE:OUTBOUND_ATTENDEE_UPDATE,RESERVATIONS_DELETED:RESERVATIONS_DELETED,RESERVATIONS_UPDATED:RESERVATIONS_UPDATED,RESERVATIONS_UPDATED_FOLLOWING_SEAT_TYPES:RESERVATIONS_UPDATED_FOLLOWING_SEAT_TYPES,SEAT_TYPES_UPDATED:SEAT_TYPES_UPDATED,SEAT_TYPE_DELETED:SEAT_TYPE_DELETED,GO_TO_ASSOCIATED_EVENTS:GO_TO_ASSOCIATED_EVENTS,RESERVATION_UPDATED:RESERVATION_UPDATED,RESERVATION_CREATED:RESERVATION_CREATED,establishReadiness,getHandlerForAction:getHandlerForAction,getHandlerQueue,getRegisteredActions:getRegisteredActions,getToken:getToken,registerAction:registerAction,removeAction:removeAction,sendPostMessage,startListeningForServiceMessages,getAssociatedEventsUrl});var external_tec_tickets_seating_service_notices_=__webpack_require__("Td2k");function iframe_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}
function iframe_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?iframe_ownKeys(Object(source),!0).forEach(function(key){defineProperty_default()(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):iframe_ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}
const{_x:iframe_x}=wp.i18n;function init(_x2){return _init.apply(this,arguments)}function _init(){_init=asyncToGenerator_default()(function*(iframe){if(!iframe){return!1}
const container=iframe.closest('.tec-tickets-seating__iframe-container');if(!container){return!1}
const token=container.dataset.token;if(!token){const defaultMessage=iframe_x('Ephemeral token not found in iframe element.','Error message','event-tickets');const error=container.dataset.error||defaultMessage;Object(external_tec_tickets_seating_service_notices_.notifyUserOfError)(error);return!1}
yield establishReadiness(iframe);return!0});return _init.apply(this,arguments)}
function getIframeElement(dom){dom=dom||document;return dom.querySelector('.tec-tickets-seating__iframe-container iframe')}
function initServiceIframe(_x3){return _initServiceIframe.apply(this,arguments)}
function _initServiceIframe(){_initServiceIframe=asyncToGenerator_default()(function*(iframe){yield init(iframe);return iframe});return _initServiceIframe.apply(this,arguments)}
function handleResize(data,dom){const iframe=getIframeElement(dom);iframe.style.height=data.height+'px'}
window.tec=window.tec||{};window.tec.tickets.seating=window.tec.tickets.seating||{};window.tec.tickets.seating.service=window.tec.tickets.seating.service||{};window.tec.tickets.seating.service.iframe=iframe_objectSpread(iframe_objectSpread({},window.tec.tickets.seating.service.iframe||{}),{},{getIframeElement,initServiceIframe,handleResize})}),"MsaN":(function(module,exports){module.exports=tec.tickets.seating.utils}),"Td2k":(function(module,exports){module.exports=tec.tickets.seating.service.notices}),"lL5a":(function(module,exports){module.exports=tec.tickets.seating.ajax})})